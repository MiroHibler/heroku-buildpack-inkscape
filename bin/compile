#!/usr/bin/env bash
BUILD_DIR=${1:-}
CACHE_DIR=${2:-}

# intltool
mkdir -p "$BUILD_DIR/.intltool"
cd "$BUILD_DIR/.intltool"
wget https://launchpad.net/intltool/trunk/0.51.0/+download/intltool-0.51.0.tar.gz
tar -xf intltool-0.51.0.tar.gz
cd intltool-0.51.0
./configure
make

# inkscape
mkdir -p "$BUILD_DIR/.inkscape/"
cd "$BUILD_DIR/.inkscape/"
wget https://inkscape.org/gallery/item/10682/inkscape-0.92.1.tar_XlpI7qT.bz2
tar -xf inkscape-0.92.1.tar_XlpI7qT.bz2
cd inkscape-0.92.1
mkdir build
cd build
cmake ..
make
make install
export PATH="$BUILD_DIR/.inkscape/inkscape-0.92.1/bin":$PATH

# test inkscape
# https://github.com/duhast/heroku-inkscape-test
# ldd $(which inkscape) | grep found

FILE1=/tmp/ink$RANDOM.png
FILE2=/tmp/ink$RANDOM.svg

inkscape --without-gui --file=./test/data/drawing.svg \
  --export-area-drawing --export-text-to-path --vacuum-defs --export-plain-svg=$FILE2 \
  --export-width=1024 --export-png=$FILE1

curl --upload-file $FILE1 https://transfer.sh/$(basename $FILE1)
curl --upload-file $FILE2 https://transfer.sh/$(basename $FILE2)
